<div class="form-container">
  <div class="form-card">
    <div class="form-header">
      <h2><i class="pi pi-file"></i> {{ isEdit ? 'Modifier' : 'Ajouter' }} une facture</h2>
      <p class="form-subtitle">Associez la facture à une commande</p>
    </div>

    <div class="form-body">
      <form [formGroup]="factureForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label"><i class="pi pi-calendar"></i> Date</label>
            <p-calendar formControlName="date" dateFormat="yy-mm-dd" class="form-input"></p-calendar>
          </div>

          <div class="form-group">
            <label class="form-label"><i class="pi pi-dollar"></i> Montant total</label>
            <p-inputNumber formControlName="totalAmount" [min]="0" mode="currency" currency="EUR" class="form-input"></p-inputNumber>
          </div>

          <div class="form-group">
            <label class="form-label"><i class="pi pi-shopping-bag"></i> Commande associée</label>
            <p-dropdown formControlName="commandeId" [options]="commandes" optionLabel="id" optionValue="id" placeholder="Sélectionner une commande" class="form-dropdown"></p-dropdown>
          </div>
        </div>

        <div *ngIf="factureForm.value.commandeId" class="order-details">
          <h4>Détails de la commande sélectionnée :</h4>
          <div *ngFor="let cmd of commandes" [hidden]="cmd.id != factureForm.value.commandeId">
            <p><b>Date :</b> {{cmd.date | date:'shortDate'}}</p>
            <p><b>Statut :</b> {{cmd.status}}</p>
            <p><b>Montant :</b> {{cmd.totalAmount | currency:'EUR'}}</p>
            <p><b>Fournisseur :</b> {{cmd.fournisseur?.name || cmd.fournisseur}}</p>
          </div>
        </div>

        <div *ngIf="error" class="error-message"><i class="pi pi-exclamation-triangle"></i> {{ error }}</div>

        <div class="form-actions">
          <button pButton type="submit" label="{{ isEdit ? 'Modifier' : 'Créer' }}" class="btn btn-primary" [disabled]="loading || factureForm.invalid"></button>
          <button pButton type="button" label="Annuler" class="btn btn-secondary" (click)="cancel()"></button>
        </div>
        <div *ngIf="loading" class="loading">Traitement...</div>
      </form>
    </div>
  </div>
  <p-toast></p-toast>
</div>
